"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function debounce(t,e){var n=void 0;return function(){for(var i=arguments.length,r=Array(i),a=0;a<i;a++)r[a]=arguments[a];clearTimeout(n),n=setTimeout(function(){n=null,t.apply(this,r)}.bind(this),e)}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),asteroidID=0;console.log("asteroids");var Asteroid=function(){function t(e,n,i){var r=this;_classCallCheck(this,t),this.id=asteroidID++,this.initialVolume=e,this.currentVolume=this.initialVolume,this.parentElement=n,this.field=i,this.asteroidElement=createDiv("smallAsteroid1",'\n\t\t\t<div class="hpBorder">\n\t\t\t\t<div class="hpBar"></div>\n\t\t\t\t<div class="HP">'+this.currentVolume+" / "+this.initialVolume+"</div>\n\t\t\t</div>\n\t\t\t"),this.volumeBarElement=this.asteroidElement.querySelector(".hpBar"),this.volumeElement=this.asteroidElement.querySelector(".HP"),this.hpElement=this.asteroidElement.querySelector(".hpBorder"),this.hpElement.style.visibility="hidden",this.asteroidElement.addEventListener("click",function(){return r.mineAsteroid(player.ship.laserPower)}),this.asteroidElement.addEventListener("mousedown",function(){return player.ship.setTarget(r)}),document.addEventListener("mouseup",function(){player.ship.clearTarget()}),document.addEventListener("dragend",function(){player.ship.clearTarget()}),this.coordinates={x:"",y:""},this.setCoordinates()}return _createClass(t,[{key:"mineAsteroid",value:function(t){var e=this.currentVolume-t;this.setHpVisible(),this.currentVolume>1&&e>0?(this.currentVolume-=t,player.ship.cargo.addOre(t),this.changeVolumeBar()):(player.ship.cargo.addOre(this.currentVolume),this.kill(),this.currentVolume=0,this.changeVolumeBar())}},{key:"getReward",value:function(){return this.initialVolume}},{key:"setHpVisible",value:function(){this.hpElement.style.visibility="visible"}},{key:"changeVolumeBar",value:function(){var t=Math.round(this.currentVolume/this.initialVolume*100);this.volumeBarElement.style.width=t+"%",this.volumeElement.innerHTML=Math.round(this.currentVolume)+"/"+this.initialVolume}},{key:"setCoordinates",value:function(){this.getRandomCoordinatesX(),this.getRandomCoordinatesY(),this.asteroidElement.style.left=this.coordinates.x+"%",this.asteroidElement.style.top=this.coordinates.y+"%"}},{key:"kill",value:function(){this.field.onKill(this)}},{key:"getRandomCoordinatesX",value:function(){this.coordinates.x=getRandomInt(2,81)}},{key:"getRandomCoordinatesY",value:function(){var t=getRandomInt(0,86);t>32&&t<80&&this.coordinates.x>41&&this.coordinates.x<55?(t=getRandomInt(80,86),this.coordinates.y=t):this.coordinates.y=t}},{key:"showAsteroid",value:function(t){t.appendChild(this.asteroidElement)}},{key:"removeAsteroid",value:function(t){t.removeChild(this.asteroidElement)}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();console.log("cargo");var cargoID=0,Cargoholder=function(){function t(e){_classCallCheck(this,t),this.shipCargoHolder=e,this.currentCargo=this.getOre(),this.id=cargoID++,this.renderCargo()}return _createClass(t,[{key:"renderCargo",value:function(){this.holdElement=createDiv("hold",'\n\t\t\t<div class="holdText">Загруженность трюма</div>\n\t\t\t<div class="holdBorder">\n\t\t\t\t<div class="holdBar"></div>\n\t\t\t\t<div class="holdStatus"> '+this.getOre()+" / "+this.shipCargoHolder+"</div>\n\t\t\t</div>\n\t\t\t"),this.currentCargoBarElement=this.holdElement.querySelector(".holdBar"),this.currentCargoElement=this.holdElement.querySelector(".holdStatus"),this.displayCargoVolume()}},{key:"addOre",value:function(t){var e=this.getOre()+t;this.getOre()<this.shipCargoHolder&&e<=this.shipCargoHolder?(this.currentCargo+=t,this.displayCargoVolume(),this.setOre(this.currentCargo)):this.currentCargo<this.shipCargoHolder&&e>this.shipCargoHolder&&(this.currentCargo=this.shipCargoHolder,this.displayCargoVolume(),this.setOre(this.currentCargo))}},{key:"setOre",value:function(t){localStorage.setItem("ore "+localStorage.getItem("activeShip"),t)}},{key:"getOre",value:function(){var t="ore "+localStorage.getItem("activeShip");return parseInt(localStorage.getItem(t))||0}},{key:"removeOre",value:function(){miningPage.addOreToCourierCargo(this.currentCargo),this.currentCargo=0,this.displayCargoVolume(),this.setOre(this.currentCargo)}},{key:"changeCargoBar",value:function(){var t=this.currentCargo/this.shipCargoHolder*100;this.currentCargoBarElement.style.width=t+"%"}},{key:"displayCargoVolume",value:function(){this.changeCargoBar(),this.currentCargoElement.innerHTML=Math.round(this.currentCargo)+" / "+this.shipCargoHolder}},{key:"show",value:function(t){this.holdElement.innerHTML="",this.renderCargo(),t.appendChild(this.holdElement)}},{key:"remove",value:function(t){t.removeChild(this.holdElement)}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();console.log("helpers");var createAndAppend=function(t,e,n,i){var r=document.createElement(e);return r.className=n,r.innerHTML=i,t.appendChild(r),r},createDiv=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=document.createElement("div");return n.className=t,n.innerHTML=e,n},getRandomInt=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},pushUrl=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;history.pushState(n,e,t),window.dispatchEvent(new Event("popstate"))};Handlebars.registerHelper("math",function(t,e,n,i){return t=parseFloat(t),n=parseFloat(n),{"+":t+n,"-":t-n,"*":t*n,"/":t/n,"%":t%n}[e]});var clear=function(){document.querySelector(".container").innerHTML=""},Timer=function(){function t(e){var n=this,i=e.duration,r=void 0===i?10:i,a=e.frequency,o=void 0===a?1e3:a,s=e.instantStart,l=void 0===s||s;_classCallCheck(this,t),this.instantStart=l,this.duration=1e3*r,this.functionArray=[],this.startTime=Date.now(),this.interval=setInterval(this.action.bind(this),o),this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e}),l&&(this.duration-=o,this.action())}return _createClass(t,[{key:"action",value:function(){if(this.currentTime=Date.now(),this.currentTime<this.startTime+this.duration)for(var t=0;t<this.functionArray.length;t++)this.functionArray[t](this);else clearInterval(this.interval),this.resolve()}},{key:"onTick",value:function(t){this.functionArray.push(t),this.instantStart&&t(this)}},{key:"getFormatedLeftTime",value:function(){var t=this.startTime+this.duration-this.currentTime,e=Math.round(t/1e3),n=Math.floor(e/60),i=Math.round(e%60);return{minutes:n<10?"0"+n:n,seconds:i<10?"0"+i:i}}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();console.log("inventory");var inventoryId=1,Inventory=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:48;_classCallCheck(this,t),this.parentElement=e,this.slots=n,this.id=inventoryId++,this.containers=[],this.inventoryHidden=!0,this.itemToContainers={},this.nextEmptyContainer=0,this.itemsArray=["ore","metall","diamonds","gas"],this.template=Handlebars.compile('\n\t\t\t{{#each containers as |container slot|}}\n\t\t\t\t<div class="inventorySlot">\n\t\t\t\t\t{{#if container.class}}\n\t\t\t\t\t\t<div class="{{container.class}}" draggable="true" title="{{container.title}}"></div>\n\t\t\t\t\t{{/if}}\n\t\t\t\t</div>\n\t\t\t{{/each}}\n\t\t');for(var i=0;i<this.slots;i++)this.containers.push({});this.createInventory()}return _createClass(t,[{key:"moveToStorage",value:function(t,e){var n=this.getFromStorage(t);n+=e,localStorage.setItem(t+"AtStorage",n)}},{key:"getFromStorage",value:function(t){return parseInt(localStorage.getItem(t+"AtStorage"))||0}},{key:"clearStorage",value:function(t){localStorage.removeItem(t+"AtStorage")}},{key:"addToInventory",value:function(t){var e=null;void 0!==this.itemToContainers[t]?e=this.itemToContainers[t]:(e=this.findEmptySlot(),this.itemToContainers[t]=e),this.containers[e]={class:t,title:t+" "+this.getFromStorage(t)},this.reloadInventory()}},{key:"removeFromInventory",value:function(t){void 0!==this.itemToContainers[t]&&(this.containers[this.itemToContainers[t]]={},delete this.itemToContainers[t],this.reloadInventory())}},{key:"findEmptySlot",value:function(){for(var t=0;t<this.containers.length;t++)if(!this.containers[t].class)return t}},{key:"runRefining",value:function(){if(!(this.getFromStorage("ore")<=0)){var t=this.getFromStorage("ore");this.diamonds=.1*t,this.metall=.35*t,this.gas=.25*t,this.moveToStorage("diamonds",this.diamonds),this.moveToStorage("metall",this.metall),this.moveToStorage("gas",this.gas),this.addToInventory("diamonds"),this.addToInventory("metall"),this.addToInventory("gas"),this.removeFromInventory("ore"),this.clearStorage("ore")}}},{key:"createInventory",value:function(){var t=this;this.inventoryContainerElement=createAndAppend(this.parentElement,"div","inventoryContainer",this.template({containers:this.containers})),this.inventoryContainerElement.setAttribute("id",this.id),this.inventorySlots=this.inventoryContainerElement.querySelectorAll(".inventorySlot"),this.filledInventorySlots=this.inventoryContainerElement.querySelectorAll(".inventorySlot div");for(var e,n=this.inventoryContainerElement.querySelectorAll(".inventorySlot div"),i=0;i<n.length;i++)n[i].addEventListener("dragstart",function(t){e=t.currentTarget,t.dataTransfer.setData("inventoryId",this.inventoryContainerElement.id)}.bind(this));for(var r=this.inventoryContainerElement.querySelectorAll(".inventorySlot"),a=0;a<r.length;a++)r[a].addEventListener("dragover",function(t){t.preventDefault()}),r[a].addEventListener("drop",function(n){if(n.dataTransfer.getData("inventoryId")==t.inventoryContainerElement.id){n.preventDefault();var i=e.parentNode,r=n.currentTarget.firstElementChild;0==n.currentTarget.childElementCount?(i.removeChild(e),n.target.appendChild(e)):1==n.currentTarget.childElementCount&&(n.currentTarget.replaceChild(e,r),i.appendChild(r))}})}},{key:"inventoryAppear",value:function(){this.inventoryHidden?(this.inventoryContainerElement.style.left="0%",this.inventoryHidden=!1):(this.inventoryContainerElement.style.left="-100%",this.inventoryHidden=!0)}},{key:"reloadInventory",value:function(){this.removeInventory(),this.createInventory(),this.inventoryHidden?this.inventoryContainerElement.style.left="-100%":this.inventoryContainerElement.style.left="0%"}},{key:"removeInventory",value:function(){this.parentElement.removeChild(this.inventoryContainerElement)}},{key:"appendInventory",value:function(){this.parentElement.appendChild(this.inventoryContainerElement)}},{key:"initialize",value:function(){for(var t=0;t<this.itemsArray.length;t++)this.getFromStorage(this.itemsArray[t])>0&&this.addToInventory(this.itemsArray[t]);this.reloadInventory()}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();console.log("map");var Map=function(){function t(e){var n=this;_classCallCheck(this,t),this.station=e,this.template=Handlebars.compile('\n\t\t\t<div class="stationButton"></div>\n\t\t\t<div class="field_342"></div>\n\t\t\t<div class="closeMap">Закрыть</div>\n\t\t'),this.mapElement=createDiv("map",this.template()),this.stationButtonElement=this.mapElement.querySelector(".stationButton"),this.field_342Element=this.mapElement.querySelector(".field_342"),this.mapCloseElement=this.mapElement.querySelector(".closeMap"),this.stationButtonElement.addEventListener("click",function(){return n.stationShow()}),this.field_342Element.addEventListener("click",function(){return n.fieldShow()}),this.mapCloseElement.addEventListener("click",function(){return n.hide()})}return _createClass(t,[{key:"stationShow",value:function(){pushUrl("/station","Станция")}},{key:"fieldShow",value:function(){pushUrl("/field/1","Поле")}},{key:"show",value:function(){document.querySelector(".container").appendChild(this.mapElement)}},{key:"hide",value:function(){document.querySelector(".container").removeChild(this.mapElement)}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();console.log("field");var Miningfield=function(){function t(e){var n=this;_classCallCheck(this,t),this.page=e,this.asteroids=[],this.template=Handlebars.compile('\n\t\t\t<div class="locationName"></div>\n\t\t\t<div class="arrowblock">\n\t\t\t\t{{#if canGoBack}}\n\t\t\t\t\t<div class="arrowBack">\n\t\t\t\t\t\t<a href="{{math page \'-\' 1}}">назад</a>\n\t\t\t\t\t</div>\n\t\t\t\t{{/if}}\n\t\t\t\t{{#if canGoForward}}\n\t\t\t\t\t<div class="arrowNext">\n\t\t\t\t\t\t<a href="{{math page \'+\' 1}}">вперед</a>\n\t\t\t\t\t</div>\n\t\t\t\t{{/if}}\n\t\t\t</div> \n\t\t\t<div class="localStatus">Безопасный сектор</div>\n\t\t\t<div class="mainField">{{{ship}}}</div>\n\t\t');for(var i=0;i<9;i++)this.asteroids.push(new Asteroid(this.randomValue(),this.mainFieldElement,this));this.scaningSpeed=60/player.ship.scanRate*1e3,setInterval(function(){return n.respawnAsteroids()},this.scaningSpeed),this.renderMiningField()}return _createClass(t,[{key:"renderMiningField",value:function(){clear(),this.battleFieldElement=createDiv("battleField",this.template({page:this.page,canGoBack:this.page>=2,canGoForward:this.page<10,ship:player.ship.getShipInFieldHTML()})),this.mainFieldElement=this.battleFieldElement.querySelector(".mainField"),this.showAsteroids(),this.displayPage()}},{key:"showAsteroids",value:function(){for(var t=0;t<this.asteroids.length;t++)this.asteroids[t].showAsteroid(this.mainFieldElement)}},{key:"respawnAsteroids",value:function(){this.asteroids.length<player.ship.targetQuantity&&this.asteroids.push(new Asteroid(this.randomValue(),this.mainFieldElement,this)),this.showAsteroids()}},{key:"randomValue",value:function(){return 5*getRandomInt(1,20)*this.page}},{key:"onKill",value:function(t){for(var e=0;e<this.asteroids.length;e++)if(this.asteroids[e].id==t.id){this.asteroids[e].removeAsteroid(this.mainFieldElement),this.asteroids.splice(e,1);break}}},{key:"displayPage",value:function(){this.battleFieldElement.querySelector(".locationName").innerHTML="Пояс астероидов №"+this.page}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();console.log("miningPage");var MiningfieldPage=function(){function t(){_classCallCheck(this,t),this.config={courierDelay:3,courierCooldown:3,overheatDuration:5,overheatCooldown:5},this.map=null,this.page=null,this.courierCargo=0,this.courierStatus=!0,this.flyAvailable=!0,this.overheatAvailable=!0,this.oreStorage=game.station.inventory.getFromStorage("ore")||0,this.miningFields={},this.template=Handlebars.compile('\n\t\t\t<div class="controllPanel">\n\t\t\t\t<div class="courier">Разгрузка</div>\n\t\t\t\t<div class="overheat">Перегрев</div> \n\t\t\t\t<div class="weapon">Оружие</div>\n\t\t\t\t<div class="miningLaser">Буры</div>\n\t\t\t\t<div class="starMap">Карта</div>\n\t\t\t</div>\n\t\t'),this.renderMiningPage()}return _createClass(t,[{key:"renderMiningPage",value:function(){var t=this;clear(),this.miningFieldElement=createDiv("miningField",this.template()),this.courierElement=this.miningFieldElement.querySelector(".courier"),this.overheatElement=this.miningFieldElement.querySelector(".overheat"),this.starMapElement=this.miningFieldElement.querySelector(".starMap"),this.shipElement=this.miningFieldElement.querySelector(".shipBorder"),this.starMapElement.addEventListener("click",function(){return t.map.show()}),this.courierElement.addEventListener("click",function(){return t.runTransportationSequence()}),this.overheatElement.addEventListener("click",function(){return t.runOverheatSequence()})}},{key:"runTransportationSequence",value:function(){var t=this;this.courierStatus&&(this.courierStatus=!1,this.runTransportationCountdown().then(function(){return player.ship.cargo.removeOre()}).then(function(){return t.runTransportationCooldown()}).then(function(){return t.endOfTransportation()}))}},{key:"runTransportationCountdown",value:function(){var t=new Timer({duration:this.config.courierDelay});return this.courierElement.style.fontSize="1vmax",t.onTick(function(t){var e=t.getFormatedLeftTime();this.courierElement.innerHTML="\n\t\t\t\tКурьер летит <br>\n\t\t\t\t"+e.minutes+":"+e.seconds+"\n\t\t\t"}.bind(this)),t.promise}},{key:"runTransportationCooldown",value:function(){var t=new Timer({duration:this.config.courierCooldown});return t.onTick(function(t){var e=t.getFormatedLeftTime();this.courierElement.innerHTML="\n\t\t\t\tКурьер недоступен <br>\n\t\t\t\t"+e.minutes+":"+e.seconds+"\n\t\t\t"}.bind(this)),t.promise}},{key:"endOfTransportation",value:function(){this.courierElement.innerHTML="Разгрузка",this.courierElement.style.fontSize="2vmax",this.courierStatus=!0,this.addOreToInventory(),this.removeOreFromCourierCargo()}},{key:"runOverheatSequence",value:function(){var t=this;this.overheatAvailable&&(this.startOverheat(),this.runOverheatCountdown().then(function(){return t.runOverheatCooldown()}).then(function(){return t.endOfOverheat()}))}},{key:"startOverheat",value:function(){this.overheatAvailable=!1,this.overheatElement.style.color="red",this.overheatElement.style.fontSize="1vmax",player.ship.laserPower*=10}},{key:"runOverheatCountdown",value:function(){var t=new Timer({duration:this.config.overheatDuration});return t.onTick(function(t){var e=t.getFormatedLeftTime();this.overheatElement.innerHTML="\n\t\t\t\tПерегрев<br>\n\t\t\t\t"+e.minutes+":"+e.seconds+"\n\t\t\t"}.bind(this)),t.promise}},{key:"runOverheatCooldown",value:function(){var t=new Timer({duration:this.config.overheatCooldown});return t.onTick(function(t){var e=t.getFormatedLeftTime();this.overheatElement.innerHTML="\n\t\t\t\tПерегрев недоступен<br>\n\t\t\t\t"+e.minutes+":"+e.seconds+"\n\t\t\t"}.bind(this)),this.overheatElement.style.color="white",player.ship.laserPower/=10,t.promise}},{key:"endOfOverheat",value:function(){this.overheatAvailable=!0,this.overheatElement.innerHTML="Перегрев",this.overheatElement.style.fontSize="2vmax"}},{key:"addOreToInventory",value:function(){game.station.inventory.moveToStorage("ore",this.courierCargo),game.station.inventory.addToInventory("ore")}},{key:"addOreToCourierCargo",value:function(t){this.courierCargo+=t}},{key:"removeOreFromCourierCargo",value:function(){this.courierCargo=0}},{key:"show",value:function(t){this.page=t,this.miningFields[t]||(this.miningFields[t]=new Miningfield(t));for(var e=this.miningFieldElement.querySelectorAll(".battleField"),n=0;n<e.length;n++)this.miningFieldElement.removeChild(e[n]);this.miningFields[t].renderMiningField(),this.miningFieldElement.appendChild(this.miningFields[t].battleFieldElement),player.ship.cargo.show(this.miningFields[this.page].battleFieldElement),document.querySelector(".container").appendChild(this.miningFieldElement)}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();console.log("player");var Player=function(){function t(e,n){_classCallCheck(this,t),this.name=e,this.ship=null}return _createClass(t,[{key:"equipShip",value:function(t){this.ship=t}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();console.log("ships");var Ship=function(){function t(){_classCallCheck(this,t),this.config={reductionTimer:3,overheatDuration:5,overheatCooldown:5},this.laserPower=null,this.scanRate=null,this.targetQuantity=null,this.maxCharge=null,this.multiplier=null,this.mineInterval=null,this.target=null,this.isOverheatAvailable=!0,this.template=Handlebars.compile('\n\t\t\t<div class="shipBorder">\n\t\t\t\t<div class="playersShip {{type}}">\n\t\t\t\t\t<div class="shieldBorder">\n\t\t\t\t\t\t<div class="shieldBar"></div>\n\t\t\t\t\t\t<div class="shield">30</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="armorBorder">\n\t\t\t\t\t\t<div class="armorBar"></div>\n\t\t\t\t\t\t<div class="armor">30</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="hpBorder">\n\t\t\t\t\t\t<div class="hpBar"></div>\n\t\t\t\t\t\t<div class="HP">30</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="chargeBorder">\n\t\t\t\t\t\t<div class="chargeBar"></div>\n\t\t\t\t\t\t<div class="charge">0</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\t\n\t\t'),this.shipInHungarTemplate=Handlebars.compile('\n\t\t\t<div class="playersShip {{type}}">\n\t\t\t\t<div class="weaponPlace1"></div>\t\t\t\t\n\t\t\t\t<div class="weaponPlace2"></div>\n\t\t\t</div>\n\t\t'),this.hitTunnelDamage()}return _createClass(t,[{key:"turnOffLasers",value:function(){0!=this.multiplier&&(this.multiplier=0)}},{key:"getActiveShip",value:function(){return localStorage.getItem("activeShip")}},{key:"hitTunnelDamage",value:function(){this.multiplierReduction=debounce(function(){this.target=null,this.reductionTick=setInterval(function(){this.getMultiplier()>1?(this.multiplier*=.8,this.renderChargeBar(),console.log(this.getMultiplier())):(this.setMultiplier(0),clearInterval(this.reductionTick),console.log(this.getMultiplier()))}.bind(this),1e3)},1e3*this.config.reductionTimer)}},{key:"getShipInFieldHTML",value:function(){return this.template({type:this.type})}},{key:"getShipInHungarHTML",value:function(){return this.shipInHungarTemplate({type:this.type})}},{key:"show",value:function(t){t.appendChild(this.shipBorderElement)}},{key:"renderChargeBar",value:function(){var t=Math.round(this.multiplier/this.maxCharge*100);document.body.querySelector(".chargeBar")&&document.body.querySelector(".charge")&&(document.body.querySelector(".chargeBar").style.width=t+"%",document.body.querySelector(".charge").innerHTML=Math.round(this.multiplier)+"/"+this.maxCharge)}},{key:"setMultiplier",value:function(t){this.multiplier+=t,0==t&&(this.multiplier=0),this.renderChargeBar()}},{key:"getMultiplier",value:function(){return this.multiplier<this.maxCharge?this.multiplier:this.maxCharge}},{key:"startMiningLaser",value:function(){this.target&&(this.mineInterval=setInterval(function(){clearInterval(this.reductionTick),this.multiplierReduction(),this.target.currentVolume>1&&this.target.currentVolume>(this.laserPower+this.multiplier)/4?(this.target.mineAsteroid((this.laserPower+this.getMultiplier())/4),this.getMultiplier()<this.maxCharge&&(this.setMultiplier(this.laserPower/16),console.log(this.getMultiplier()))):(this.target.mineAsteroid(this.target.currentVolume),this.stopMining()),this.renderChargeBar()}.bind(this),250))}},{key:"setTarget",value:function(t){this.target=t,this.startMiningLaser()}},{key:"clearTarget",value:function(){this.target=null,this.stopMining()}},{key:"stopMining",value:function(){clearInterval(this.mineInterval)}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();console.log("market");var ShipMarket=function(){function t(e){var n=this;_classCallCheck(this,t),this.station=e,this.shipmarketElement=createDiv("shipmarket"),this.marketContainerElement=createAndAppend(this.shipmarketElement,"div","marketContainer",""),this.backElement=createAndAppend(this.marketContainerElement,"div","back","Назад"),this.backElement.addEventListener("click",function(){return pushUrl("/station","Станция")}),this.waspElement=createAndAppend(this.marketContainerElement,"div","wasp",""),this.waspElement.addEventListener("click",function(){return n.setWasp()}),this.frigateElement=createAndAppend(this.marketContainerElement,"div","frigate",""),this.mirageElement=createAndAppend(this.marketContainerElement,"div","mirage",""),this.transportElement=createAndAppend(this.marketContainerElement,"div","transport",""),this.transportElement.addEventListener("click",function(){return n.setTruck()}),this.cruiserElement=createAndAppend(this.marketContainerElement,"div","cruiser",""),this.battleshipElement=createAndAppend(this.marketContainerElement,"div","battleship",""),this.carrierElement=createAndAppend(this.marketContainerElement,"div","carrier",""),this.dreadnoughtElement=createAndAppend(this.marketContainerElement,"div","dreadnought",""),this.reaperElement=createAndAppend(this.marketContainerElement,"div","reaper",""),this.flagmanElement=createAndAppend(this.marketContainerElement,"div","flagman",""),this.hungarContainerElement=createAndAppend(this.shipmarketElement,"div","hungarContainer",""),this.stationNameElement=createAndAppend(this.hungarContainerElement,"div","stationName","Станция: Земляне люминатые"),this.newShipElement=createAndAppend(this.hungarContainerElement,"div","newShip",""),this.weaponPlace1Element=createAndAppend(this.newShipElement,"div","weaponPlace1",""),this.weaponPlace2Element=createAndAppend(this.newShipElement,"div","weaponPlace2",""),this.weaponPlace3Element=createAndAppend(this.newShipElement,"div","weaponPlace3",""),this.weaponPlace4Element=createAndAppend(this.newShipElement,"div","weaponPlace4",""),this.weaponPlace5Element=createAndAppend(this.newShipElement,"div","weaponPlace5",""),this.weaponPlace6Element=createAndAppend(this.newShipElement,"div","weaponPlace6",""),this.shipDescriptionElement=createAndAppend(this.shipmarketElement,"div","shipDescription",""),this.weaponDescriptionElement=createAndAppend(this.shipDescriptionElement,"div","weaponDescription",'<p class="descriptionName">Орудийные системы</p>'),this.containerDescriptionElement=createAndAppend(this.weaponDescriptionElement,"div","containerDescription","<p>Оружейных точек: 6</p>\n\t\t\t<p>\t3 малые точки</p>\n\t\t\t<p>\t2 средние точки</p>\n\t\t\t<p>\t1 большая точка</p>"),this.armorDescriptionElement=createAndAppend(this.shipDescriptionElement,"div","armorDescription",'<p class="descriptionName">Системы защиты</p>'),this.containerDescriptionElement=createAndAppend(this.armorDescriptionElement,"div","containerDescription","<p>Броня корпуса: 20 000</p>\n\t\t\t<p>Броневое поглощение: 50%</p>\n\t\t\t<p>Мощность щитов: 30 000</p>"),this.driveDescriptionElement=createAndAppend(this.shipDescriptionElement,"div","driveDescription",'<p class="descriptionName">Силовая установка</p>'),this.containerDescriptionElement=createAndAppend(this.driveDescriptionElement,"div","containerDescription","<p>Узлов для модулей усиления: 3</p>\n\t\t\t<p>Базовая мощность двигателей: 20000</p>")}return _createClass(t,[{key:"setWasp",value:function(){player.equipShip(ships.wasp),localStorage.setItem("activeShip","wasp"),game.station.renderStation(),pushUrl("/station","Станция")}},{key:"setTruck",value:function(){player.equipShip(ships.truck),localStorage.setItem("activeShip","truck"),game.station.renderStation(),pushUrl("/station","Станция")}},{key:"show",value:function(){document.querySelector(".container").appendChild(this.shipmarketElement)}},{key:"hideMarket",value:function(){document.querySelector(".container").removeChild(this.shipmarketElement)}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();console.log("station");var Station=function(){function t(){_classCallCheck(this,t),this.map=null,this.shipmarket=null,this.template=Handlebars.compile('\n\t\t\t<div class="controllPanel">\n\t\t\t\t<div class="shipsMarket">Корабли</div>\t\n\t\t\t\t<div class="weaponsMarket">Модули</div> \n\t\t\t\t<div class="repairMarket">Ремонт</div>\n\t\t\t\t<div class="sellMarket">Продажа</div>\n\t\t\t\t<div class="refineButton" title="Переработать всю руду в минералы">Очистка</div>\n\t\t\t\t<div class="wallet">Кошелек</div>\n\t\t\t\t<div class="inventory">Инвентарь</div>\n\t\t\t\t<div class="starMap">Карта</div>\t\t\t\n\t\t\t</div>\n\t\t\t<div class="hungarContainer">\n\t\t\t\t<div class="stationName">Станция: Земляне люминатые</div>\n\t\t\t\t{{{ship}}}\n\t\t\t\t<div class="upgrades"></div>\n\t\t\t</div>\n\t\t'),this.renderStation()}return _createClass(t,[{key:"renderStation",value:function(){var t=this;clear(),this.stationElement=createDiv("station",this.template({ship:player.ship.getShipInHungarHTML()})),this.sellElement=this.stationElement.querySelector(".sellMarket"),this.marketElement=this.stationElement.querySelector(".shipsMarket"),this.moduleMarket=this.stationElement.querySelector(".weaponsMarket"),this.starMapElement=this.stationElement.querySelector(".starMap"),this.inventoryElement=this.stationElement.querySelector(".inventory"),this.refineElement=this.stationElement.querySelector(".refineButton"),this.marketElement.addEventListener("click",function(){return pushUrl("/market","Магазин")}),this.moduleMarket.addEventListener("click",function(){return t.showModules()}),this.sellElement.addEventListener("click",function(){return t.sell()}),this.starMapElement.addEventListener("click",function(){return t.map.show()}),this.inventoryElement.addEventListener("click",function(){return t.inventory.inventoryAppear()}),this.refineElement.addEventListener("click",function(){return t.inventory.runRefining()}),this.inventory=new Inventory(this.stationElement.querySelector(".hungarContainer")),this.inventory.initialize(),this.upgradeLasersElement=this.stationElement.querySelector(".cruiser"),this.upgradeTargetQuantityElement=this.stationElement.querySelector(".carrier"),this.upgradeScaningSpeedElement=this.stationElement.querySelector(".truck"),this.show()}},{key:"sell",value:function(){wallet.addMoney(this.inventory.getFromStorage("ore")),this.inventory.clearStorage("ore"),this.inventory.removeFromInventory("ore"),this.inventory.inventoryContainerElement.style.left="0%"}},{key:"showModules",value:function(){this.hideStation(),this.show(),this.inventory.inventoryContainerElement.style.left="0%",this.stationElement.querySelector(".upgrades").style.visibility="visible"}},{key:"show",value:function(){document.querySelector(".container").appendChild(this.stationElement)}},{key:"hideStation",value:function(){document.querySelector(".container").removeChild(this.stationElement)}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Wallet=function(){function t(e){_classCallCheck(this,t),this.station=e,this.walletElement=createDiv("wallet",this.getMoney()+" Золото")}return _createClass(t,[{key:"getMoney",value:function(){return parseInt(localStorage.getItem("money"))||0}},{key:"setMoney",value:function(t){localStorage.setItem("money",t)}},{key:"addMoney",value:function(t){var e=this.getMoney()+t;this.setMoney(e)}},{key:"spendMoney",value:function(t){if(this.getMoney()<t)throw new Error("Недостаточно золота!");var e=this.getMoney()-t;this.setMoney(e)}},{key:"show",value:function(t){t.appendChild(this.walletElement)}},{key:"displayMoney",value:function(){this.walletElement.innerHTML=this.getMoney()+" Золото"}}]),t}();console.log("wasp");var Wasp=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.type="wasp",t.shipImageField="url('/images/i/wasp.png')",t.shipImageHungar="url('/images/wasp.png')",t.shipSize={width:"524px",height:"330px"},t.cargoCapacity=2e3,t.laserPower=2,t.scanRate=15,t.cargo=new Cargoholder(t.cargoCapacity),t.maxCharge=200,t.multiplier=0,t.targetQuantity=15,t}return _inherits(e,t),e}(Ship),Truck=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.type="truck",t.shipImageField="url('/images/i/truck.png')",t.shipImageHungar="url('/images/truck.png')",t.shipSize={width:"585px",height:"385px"},t.cargoCapacity=1e4,t.laserPower=20,t.scanRate=15,t.cargo=new Cargoholder(t.cargoCapacity),t.maxCharge=500,t.multiplier=0,t.targetQuantity=15,t}return _inherits(e,t),e}(Ship);console.log("main");var game={},ships={wasp:new Wasp,truck:new Truck},player=new Player("Alchemist");player.equipShip(ships[localStorage.getItem("activeShip")]||ships.wasp),game.station=new Station;var shipmarket=new ShipMarket,miningPage=new MiningfieldPage,map=new Map(game.station);game.station.map=map,game.station.shipmarket=shipmarket,miningPage.map=map,shipmarket.station=game.station;var stationRoute=crossroads.addRoute("/",function(){clear(),game.station.show()}),stationRoute=crossroads.addRoute("/station",function(){clear(),game.station.show(),player.ship.turnOffLasers()}),marketRoute=crossroads.addRoute("/market",function(){clear(),shipmarket.show()}),fieldRoute=crossroads.addRoute("/field/{page}",function(t){clear(),miningPage.show(t)});window.addEventListener("popstate",function(){crossroads.parse(window.location.pathname)}),document.body.addEventListener("click",function(t){"A"==t.target.nodeName&&(t.preventDefault(),pushUrl(t.target.pathname))}),window.dispatchEvent(new Event("popstate"));